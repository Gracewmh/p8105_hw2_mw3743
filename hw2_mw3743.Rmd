---
title: "HW2 Data Wrangling I"
author: "Minghui Wang" 
date: '`r format(Sys.time(), "%Y-%m-%d")`'
output: github_document
---

```{r setup, echo = FALSE, message = FALSE}
library(tidyverse)
library(readxl)
library(haven)
```
[HW2](https://p8105.com/homework_2.html) assignment reinforces ideas in [Data Wrangling I](https://p8105.com/topic_data_wrangling_i.html). Here are the codes focusing on question 1-3.

# Problem 1
## Import and clean the NYC Transit.csv
```{r}
trans_entr_df = 
  read_csv("data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv",
  col_types = cols( "Route8" = "c","Route9" = "c","Route10" = "c","Route11" = "c")) |>
  janitor::clean_names() |> 
  select(
    line, station_name, station_latitude, station_longitude, starts_with("route"), entry, vending, entrance_type, ada
  ) |> 
  mutate(entry = if_else(entry == "YES", TRUE, FALSE))
```

```{r}
dim(trans_entr_df)
```
A short paragraph about this dataset:
This dataset contains 32 variables, with 22 being character variables (such as Division, Line, Station Name, and Route1 to Route7), 8 being numeric variables (including Station Latitude, Station Longitude, Entrance Latitude, and Entrance Longitude), and 2 being logical variables (ADA and Free Crossover). So far, I have standardized the column names by converting them to lowercase and treated all route variables as character types. The resulting dataset has dimensions of 1868 rows and 19 columns. Currently, the data is not tidy because the route numbers are spread across multiple columns (from "Route1" to "Route11") rather than being combined into a single column as a variable.

## Answer Questions
1. How many distinct stations are there? Note that stations are identified both by name and by line (e.g. 125th St 8th Avenue; 125st Broadway; 125st Lenox); the distinct function may be useful here.
```{r}
trans_entr_df |> 
  select(station_name, line) |>
  distinct()
```
- There are 465 distinct stations.

2. How many stations are ADA compliant?
```{r}
trans_entr_df |> 
  filter(ada == "TRUE")|>
  select(station_name, line) |>
  distinct()
```
- There are 84 distinct stations which are ADA compliant.

3. What proportion of station entrances / exits without vending allow entrance?
```{r}
trans_entr_df |> 
  filter(vending == "NO")|>
  pull(entry) |>
  mean()
```
- 37.70% of station entrances / exits without vending allow entrance.  

## Reformat data 
To make route number and route name distinct variables. 
1. How many distinct stations serve the A train?
```{r}
trans_entr_df |> 
    pivot_longer(
      cols = route1:route11,
      names_to = "route_num", 
      values_to = "route") |> 
    filter(route == "A") |> 
    select(station_name, line) |>
    distinct()
```
- There are 60 distinct stations serve the A train.

2. Of the stations that serve the A train, how many are ADA compliant?
```{r}
trans_entr_df |> 
    pivot_longer(
      cols = route1:route11,
      names_to = "route_num", 
      values_to = "route") |> 
    filter(route == "A", ada == TRUE) |> 
    select(station_name, line) |>
    distinct()
```
- Of the stations that serve the A train, 17 stations are ADA compliant.

# Problem 2

## Read and clean the Mr. Trash Wheel sheet
- specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel
- use reasonable variable names
- omit rows that do not include dumpster-specific data
- round the number of sports balls to the nearest integer and converts the result to an integer variable (using as.integer)
```{r}
mr_trash_whl_df =
  read_excel("data/202409_Trash_Wheel_Collection_Data.xlsx" , 
             #specify the sheet in the Excel file
             sheet = 'Mr. Trash Wheel',
             #omit non-data entries
             range = cell_cols(1:14),
             skip = 1,
             na = c("NA", "", "."))|> 
  #use reasonable variable names
  janitor::clean_names()|> 
  #omit rows that do not include dumpster-specific data
  drop_na(dumpster) |>
  #round the number of sports balls to the nearest integer and converts the result to an integer variable
  mutate(sports_balls = as.integer(round(sports_balls)))
```
## Read and clean the Professor Trash Wheel sheet 
```{r}
prof_trash_whl_df = 
  read_excel("data/202409_Trash_Wheel_Collection_Data.xlsx" , 
             #specify the sheet in the Excel file
             sheet = 'Professor Trash Wheel',
             #omit non-data entries
             skip = 1, 
             na = c("NA", "", "."))|> 
  #use reasonable variable names
  janitor::clean_names()|> 
  #omit rows that do not include dumpster-specific data
  drop_na(dumpster) |>
  #round the number of sports balls to the nearest integer and converts the result to an integer variable
  mutate(trash_wheel = "Professor Trash Wheel")
```
## Read and clean the Gwynnda Trash Wheel sheet
```{r}
gwynd_trash_whl_df = 
  read_excel("data/202409_Trash_Wheel_Collection_Data.xlsx" , 
             #specify the sheet in the Excel file
             sheet = 'Gwynnda Trash Wheel',
             #omit non-data entries
             skip = 1, 
             na = c("NA", "", "."))|> 
  #use reasonable variable names
  janitor::clean_names()|> 
  #omit rows that do not include dumpster-specific data
  drop_na(dumpster) |>
  #round the number of sports balls to the nearest integer and converts the result to an integer variable
  mutate(trash_wheel = "Gwynnda Trash Wheel")
```

## Combine these three datasets
- produce a single tidy dataset. 
- add an additional variable to both datasets before combining to keep track of which Trash Wheel is.
```{r}
mr_trash_whl_df = mutate(mr_trash_whl_df, 
                         year = as.double(year),
                         trash_wheel = "Mr. Trash Wheel")

sum_trash_whl_df = 
  bind_rows(mr_trash_whl_df, prof_trash_whl_df, gwynd_trash_whl_df) |> 
  pivot_longer(cols = volume_cubic_yards:sports_balls, 
               names_to = "trash_type", 
               values_to = "amount")|> 
  relocate(trash_wheel) 
```

# Problem 3
```{r}
```

